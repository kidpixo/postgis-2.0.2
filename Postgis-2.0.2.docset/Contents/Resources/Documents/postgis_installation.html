<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 2. Installation</title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="PostGIS 2.0.2SVN Manual"><link rel="up" href="index.html" title="PostGIS 2.0.2SVN Manual"><link rel="prev" href="postgis_introduction.html" title="Chapter 1. Introduction"><link rel="next" href="PostGIS_FAQ.html" title="Chapter 3. PostGIS Frequently Asked Questions"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 2. Installation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="postgis_introduction.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="PostGIS_FAQ.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="postgis_installation"></a>Chapter 2. Installation</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="postgis_installation.html#id2801991">2.1. Short Version</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#id2841922">2.2. Requirements</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#id2842259">2.3. Getting the Source</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#PGInstall">2.4. Installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="postgis_installation.html#installation_configuration">2.4.1. Configuration</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#id2842878">2.4.2. Building</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#make_install_postgis_extensions">2.4.3. Building PostGIS Extensions and Deploying them</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#id2843214">2.4.4. Testing</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#id2843403">2.4.5. Installation</a></span></dt></dl></dd><dt><span class="sect1"><a href="postgis_installation.html#create_new_db">2.5. Create a spatially-enabled database on PostgreSQL lower than 9.1</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#create_new_db_extensions">2.6. Creating a spatial database using EXTENSIONS</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#loading_extras_tiger_geocoder">2.7. Installing, Upgrading Tiger Geocoder and loading data</a></span></dt><dd><dl><dt><span class="sect2"><a href="postgis_installation.html#install_tiger_geocoder">2.7.1. Tiger Geocoder Enabling your PostGIS database</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#upgrade_tiger_geocoder">2.7.2. Upgrading your Tiger Geocoder Install</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#tiger_geocoder_loading_data">2.7.3. Loading Tiger Data</a></span></dt></dl></dd><dt><span class="sect1"><a href="postgis_installation.html#templatepostgis">2.8. Create a spatially-enabled database from a template</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#upgrading">2.9. Upgrading</a></span></dt><dd><dl><dt><span class="sect2"><a href="postgis_installation.html#soft_upgrade">2.9.1. Soft upgrade</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#hard_upgrade">2.9.2. Hard upgrade</a></span></dt></dl></dd><dt><span class="sect1"><a href="postgis_installation.html#id2844803">2.10. Common Problems</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#id2844910">2.11. JDBC</a></span></dt><dt><span class="sect1"><a href="postgis_installation.html#id2844985">2.12. Loader/Dumper</a></span></dt></dl></div><p>
	This chapter details the steps required to install PostGIS.
  </p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2801991"></a>2.1. Short Version</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The raster support is currently optional, but installed by default. For installing using the PostgreSQL 9.1+ extensions model it is required.
	Please refer to <a href="postgis_installation.html#make_install_postgis_extensions" title="2.4.3. Building PostGIS Extensions and Deploying them">Section 2.4.3, &#8220;Building PostGIS Extensions and Deploying them&#8221;</a> if you are using PostgreSQL 9.1+.</p></td></tr></table></div><p>All the .sql files once installed will be installed in <code class="code">share/contrib/postgis-2.0</code> folder
		of your PostgreSQL install</p><p>The <code class="varname">postgis_comments.sql</code>, <code class="varname">raster_comments.sql</code>, <code class="varname">topology_comments.sql</code>
		generate quick help tips for each function that can be accessed via pgAdmin III or psql. In psql with a command of the form e.g.<code class="varname">\dd ST_SetPoint</code></p><pre class="programlisting">tar xvfz postgis-2.0.2SVN.tar.gz
cd postgis-2.0.2SVN
./configure --with-raster --with-topology --with-gui
make
make install
createdb yourdatabase
createlang plpgsql yourdatabase
psql -d yourdatabase -f postgis.sql
psql -d yourdatabase -f postgis_comments.sql
psql -d yourdatabase -f spatial_ref_sys.sql
psql -d yourdatabase -f rtpostgis.sql
psql -d yourdatabase -f raster_comments.sql
psql -d yourdatabase -f topology/topology.sql
psql -d yourdatabase -f doc/topology_comments.sql

</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>topology_comments.sql since its an optional feature is not installed by make install or make comments install. However if
you do a <code class="varname">make comments</code> or <code class="varname">make topology_comments.sql</code>, it will be generated in the docs folder</p></td></tr></table></div><p>
	  The rest of this chapter goes into detail each of the above installation
	  steps.
	</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2841922"></a>2.2. Requirements</h2></div></div></div><p>
	  PostGIS has the following requirements for building and usage:
	</p><p>
	  <span class="bold"><strong>Required</strong></span>
	</p><div class="itemizedlist"><ul type="disc"><li><p>
		  PostgreSQL 8.4 or higher. A complete installation
		  of PostgreSQL (including server headers) is required. PostgreSQL
		  is available from
		  <a href="http://www.postgresql.org" target="_top">
			http://www.postgresql.org
		  </a>
		  .
		</p><p>For a full PostgreSQL / PostGIS support matrix and PostGIS/GEOS support matrix refer to 
			<a href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS" target="_top">http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS</a>
		</p></li><li><p>
		  GNU C compiler (<code class="filename">gcc</code>). Some other ANSI C compilers
		  can be used to compile PostGIS, but we find far fewer problems when
		  compiling with <code class="filename">gcc</code>.
		</p></li><li><p>
		  GNU Make (<code class="filename">gmake</code> or <code class="filename">make</code>).
		  For many systems, GNU <code class="filename">make</code> is the default version
		  of make. Check the version by invoking <code class="filename">make -v</code>.
		  Other versions of <code class="filename">make</code> may not process the
		  PostGIS <code class="filename">Makefile</code> properly.
		</p></li><li><p>
		  Proj4 reprojection library, version 4.6.0 or greater. The Proj4
		  library is used to provide coordinate reprojection support within
		  PostGIS. Proj4 is available for download from
		  <a href="http://trac.osgeo.org/proj/" target="_top">
			http://trac.osgeo.org/proj/
		  </a>
		  .
		</p></li><li><p>
		  GEOS geometry library, version 3.2.2 or greater, but GEOS 3.3.2+ is recommended.  Without GEOS 3.3,
			you will be missing some major enhancements with handling of topological exceptions and improvements to geometry validation and
			making geometries valid such as ST_ValidDetail and ST_MakeValid.  GEOS 3.3.2+ is also required for topology support.  GEOS is available for download from
		  <a href="http://trac.osgeo.org/geos/" target="_top">
			http://trac.osgeo.org/geos/
		  </a> and 3.3+ is backward-compatible with older versions so fairly safe to upgrade.
		</p></li><li><p>
		  LibXML2, version 2.5.x or higher. LibXML2 is currently used in some imports
		  functions (ST_GeomFromGML and ST_GeomFromKML). LibXML2 is available for download from 
		  <a href="http://xmlsoft.org/downloads.html" target="_top">http://xmlsoft.org/downloads.html</a>.
		</p></li><li><p>
		  JSON-C, version 0.9 or higher. JSON-C is currently used to import GeoJSON via the
		  function ST_GeomFromGeoJson. JSON-C is available for download from
		  <a href="http://oss.metaparadigm.com/json-c/" target="_top">http://oss.metaparadigm.com/json-c/</a>.
		</p></li><li><p>
		  GDAL, version 1.6 or higher (1.9 or higher is preferable since some things will not work well with lower versions).  This is needed for raster support and will be required in final release of PostGIS 2.0.
		  <a href="http://trac.osgeo.org/gdal/wiki/DownloadSource" target="_top">http://trac.osgeo.org/gdal/wiki/DownloadSource</a>.
		</p></li></ul></div><p>
	  <span class="bold"><strong>Optional</strong></span>
	</p><div class="itemizedlist"><ul type="disc"><li><p>
		  GTK (requires GTK+2.0 (2.8+)) to compile the shp2pgsql-gui shape file loader.
		  <a href="http://www.gtk.org/" target="_top">
			http://www.gtk.org/
		  </a>
		  .
		</p></li><li><p>
		 CUnit (<code class="filename">CUnit</code>). This is needed for regression testing. <a href="http://cunit.sourceforge.net/" target="_top">http://cunit.sourceforge.net/</a>
		</p></li><li><p>
		  Apache Ant (<code class="filename">ant</code>) is required for building any of
		  the drivers under the <code class="filename">java</code> directory. Ant is
		  available from
		  <a href="http://ant.apache.org" target="_top">
			http://ant.apache.org
		  </a>
		  .
		</p></li><li><p>
		  DocBook (<code class="filename">xsltproc</code>) is required for building the
		  documentation. Docbook is available from
		  <a href="http://www.docbook.org/" target="_top">
			http://www.docbook.org/
		  </a>
		  .
		</p></li><li><p>
		  DBLatex (<code class="filename">dblatex</code>) is required for building the
		  documentation in PDF format. DBLatex is available from
		  <a href="http://dblatex.sourceforge.net/" target="_top">
			http://dblatex.sourceforge.net/
		  </a>
		  .
		</p></li><li><p>
		  ImageMagick (<code class="filename">convert</code>) is required to generate the
		  images used in the documentation. ImageMagick is available from
		  <a href="http://www.imagemagick.org/" target="_top">
			http://www.imagemagick.org/
		  </a>
		  .
		</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2842259"></a>2.3. Getting the Source</h2></div></div></div><p>
	  Retrieve the PostGIS source archive from the downloads website
	  <a href="http://www.postgis.org/download/postgis-2.0.2SVN.tar.gz" target="_top">
		http://www.postgis.org/download/postgis-2.0.2SVN.tar.gz
	  </a>
	</p><pre class="programlisting">wget http://www.postgis.org/download/postgis-2.0.2SVN.tar.gz
tar -xvzf postgis-2.0.2SVN.tar.gz</pre><p>
	  This will create a directory called
	  <code class="varname">postgis-2.0.2SVN</code> in the current working
	  directory.
	</p><p>
	  Alternatively, checkout the source from the
	  <a href="http://subversion.apache.org/" target="_top">
		svn
	  </a>
	  repository
	  <a href="http://svn.osgeo.org/postgis/branches/2.0" target="_top">
		http://svn.osgeo.org/postgis/branches/2.0
	  </a>
	  .
	</p><pre class="programlisting">svn checkout http://svn.osgeo.org/postgis/branches/2.0/ postgis-2.0.2SVN</pre><p>
	  Change into the newly created
	  <code class="varname">postgis-2.0.2SVN</code> directory to continue
	  the installation.
	</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PGInstall"></a>2.4. Installation</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="postgis_installation.html#installation_configuration">2.4.1. Configuration</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#id2842878">2.4.2. Building</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#make_install_postgis_extensions">2.4.3. Building PostGIS Extensions and Deploying them</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#id2843214">2.4.4. Testing</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#id2843403">2.4.5. Installation</a></span></dt></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		Many OS systems now include pre-built packages for PostgreSQL/PostGIS.
		In many cases compilation is only necessary if you want the most
		bleeding edge versions or you are a package maintainer.
	  </p><p>This section includes general compilation instructions, if you are compiling for Windows etc
	  	or another OS, you may find additional more detailed help at <a href="http://trac.osgeo.org/postgis/wiki/UsersWikiInstall" target="_top">PostGIS User contributed compile/install guides</a> and <a href="http://trac.osgeo.org/postgis/wiki/DevWikiMain" target="_top">PostGIS Dev Wiki</a>.</p><p>Pre-Built Packages for various OS are listed in <a href="http://trac.osgeo.org/postgis/wiki/UsersWikiPackages" target="_top">PostGIS Pre-built Packages</a>.</p><p>If you are a windows user, you can get stable builds via Stackbuilder or <a href="http://www.postgis.org/download/windows/" target="_top">PostGIS Windows download site</a>
	  We also have <a href="http://www.postgis.org/download/windows/experimental.php" target="_top">very bleeding-edge windows experimental builds</a> that are built usually once or twice a week or whenever anything exciting happens.  You can
	  use these to experiment with the in progress releases of PostGIS</p></td></tr></table></div><p>
	  The PostGIS module is an extension to the PostgreSQL backend server. As
	  such, PostGIS 2.0.2SVN <span class="emphasis"><em>requires</em></span> full
	  PostgreSQL server headers access in order to compile. It can be built
	  against PostgreSQL versions 8.4 or higher. Earlier
	  versions of PostgreSQL are <span class="emphasis"><em>not</em></span> supported.
	</p><p>
	  Refer to the PostgreSQL installation guides if you haven't already
	  installed PostgreSQL.
	  <a href="http://www.postgresql.org" target="_top">
		http://www.postgresql.org
	  </a>
	  .
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		For GEOS functionality, when you install PostgresSQL you may need to
		explicitly link PostgreSQL against the standard C++ library:
	  </p><pre class="programlisting">LDFLAGS=-lstdc++ ./configure [YOUR OPTIONS HERE]</pre><p>
		This is a workaround for bogus C++ exceptions interaction with older
		development tools. If you experience weird problems (backend
		unexpectedly closed or similar things) try this trick. This will require
		recompiling your PostgreSQL from scratch, of course.
	  </p></td></tr></table></div><p>
	  The following steps outline the configuration and compilation of the
	  PostGIS source. They are written for Linux users and will not work on
	  Windows or Mac.
	</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="installation_configuration"></a>2.4.1. Configuration</h3></div></div></div><p>
		As with most linux installations, the first step is to generate the
		Makefile that will be used to build the source code. This is done by
		running the shell script
	  </p><p>
		<span><strong class="command">./configure</strong></span>
	  </p><p>
		With no additional parameters, this command will attempt to
		automatically locate the required components and libraries needed to
		build the PostGIS source code on your system. Although this is the most
		common usage of <span><strong class="command">./configure</strong></span>, the script accepts
		several parameters for those who have the required libraries and
		programs in non-standard locations.
	  </p><p>
		The following list shows only the most commonly used parameters. For a
		complete list, use the <span><strong class="command">--help</strong></span> or
		<span><strong class="command">--help=short</strong></span> parameters.
	  </p><div class="variablelist"><dl><dt><span class="term"><span><strong class="command">--prefix=PREFIX</strong></span></span></dt><dd><p>
			  This is the location the PostGIS libraries and SQL scripts will be
			  installed to. By default, this location is the same as the
			  detected PostgreSQL installation.
			</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
				This parameter is currently broken, as the package will only
				install into the PostgreSQL installation directory. Visit
				<a href="http://trac.osgeo.org/postgis/ticket/635" target="_top">
				  http://trac.osgeo.org/postgis/ticket/635
				</a>
				to track this bug.
			  </p></td></tr></table></div></dd><dt><span class="term"><span><strong class="command">--with-pgconfig=FILE</strong></span></span></dt><dd><p>
			  PostgreSQL provides a utility called <span><strong class="command">pg_config</strong></span>
			  to enable extensions like PostGIS to locate the PostgreSQL
			  installation directory. Use this parameter
			  (<span><strong class="command">--with-pgconfig=/path/to/pg_config</strong></span>) to
			  manually specify a particular PostgreSQL installation that PostGIS
			  will build against.
			</p></dd><dt><span class="term"><span><strong class="command">--with-gdalconfig=FILE</strong></span></span></dt><dd><p>
			  GDAL, a required library, provides functionality needed for raster support
			  <span><strong class="command">gdal-config</strong></span> to enable software installations to
			  locate the GDAL installation directory. Use this parameter
			  (<span><strong class="command">--with-gdalconfig=/path/to/gdal-config</strong></span>) to
			  manually specify a particular GDAL installation that PostGIS will
			  build against.			  
			</p></dd><dt><span class="term"><span><strong class="command">--with-geosconfig=FILE</strong></span></span></dt><dd><p>
			  GEOS, a required geometry library, provides a utility called
			  <span><strong class="command">geos-config</strong></span> to enable software installations to
			  locate the GEOS installation directory. Use this parameter
			  (<span><strong class="command">--with-geosconfig=/path/to/geos-config</strong></span>) to
			  manually specify a particular GEOS installation that PostGIS will
			  build against.
			</p></dd><dt><span class="term"><span><strong class="command">--with-xml2config=FILE</strong></span></span></dt><dd><p>
			  LibXML is the library required for doing GeomFromKML/GML processes.
			  It normally is found if you have libxml installed, but if not or you want
			  a specific version used, you'll need to point PostGIS at a specific 
			  <code class="filename">xml2-config</code> confi file to enable software installations to
			  locate the LibXML installation directory. Use this parameter
			  (<span><strong class="command">&gt;--with-xml2config=/path/to/xml2-config</strong></span>) to
			  manually specify a particular LibXML installation that PostGIS will
			  build against.
			</p></dd><dt><span class="term"><span><strong class="command">--with-projdir=DIR</strong></span></span></dt><dd><p>
			  Proj4 is a reprojection library required by PostGIS. Use this
			  parameter (<span><strong class="command">--with-projdir=/path/to/projdir</strong></span>) to
			  manually specify a particular Proj4 installation directory that
			  PostGIS will build against.
			</p></dd><dt><span class="term"><span><strong class="command">--with-libiconv=DIR</strong></span></span></dt><dd><p>
			  Directory where iconv is installed.
			</p></dd><dt><span class="term"><span><strong class="command">--with-jsondir=DIR</strong></span></span></dt><dd><p>
			  <a href="http://oss.metaparadigm.com/json-c/" target="_top">JSON-C</a> is an MIT-licensed JSON library required by PostGIS ST_GeomFromJSON support. Use this
			  parameter (<span><strong class="command">--with-jsondir=/path/to/jsondir</strong></span>) to
			  manually specify a particular JSON-C installation directory that
			  PostGIS will build against.
			</p></dd><dt><span class="term"><span><strong class="command">--with-gui</strong></span></span></dt><dd><p>
			  Compile the data import GUI (requires GTK+2.0).  This will create shp2pgsql-gui graphical interface
			  to shp2pgsql.
			</p></dd><dt><span class="term"><span><strong class="command">--with-raster</strong></span></span></dt><dd><p>
			  Compile with raster support.  This will build rtpostgis-2.0.2SVN library and rtpostgis.sql file.  This may not
			  be required in final release as plan is to build in raster support by default. 
			</p></dd><dt><span class="term"><span><strong class="command">--with-topology</strong></span></span></dt><dd><p>
			  Compile with topology support.  This will build the topology.sql file.  There is no corresponding library
			  as all logic needed for topology is in postgis-2.0.2SVN library.
			</p></dd><dt><span class="term"><span><strong class="command">--with-gettext=no</strong></span></span></dt><dd><p>
			  By default PostGIS will try to detect gettext support and compile with it, however if you run into incompatibility issues that
			  cause breakage of loader, you can disable it entirely with this command.  Refer to ticket <a href="http://trac.osgeo.org/postgis/ticket/748" target="_top">http://trac.osgeo.org/postgis/ticket/748</a> for an example issue solved by configuring with this.
			  NOTE: that you aren't missing much by turning this off.  This is used for international help/label support for the GUI loader which is not yet documented
			  and still experimental.
			</p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		  If you obtained PostGIS from the SVN
		  <a href="http://svn.osgeo.org/postgis/trunk/" target="_top">
			repository
		  </a>
		  , the first step is really to run the script
		</p><p>
		  <span><strong class="command">./autogen.sh</strong></span>
		</p><p>
		  This script will generate the <span><strong class="command">configure</strong></span> script that
		  in turn is used to customize the installation of PostGIS.
		</p><p>
		  If you instead obtained PostGIS as a tarball, running
		  <span><strong class="command">./autogen.sh</strong></span> is not necessary as
		  <span><strong class="command">configure</strong></span> has already been generated.
		</p></td></tr></table></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2842878"></a>2.4.2. Building</h3></div></div></div><p>
		Once the Makefile has been generated, building PostGIS is as simple as
		running
	  </p><p>
		<span><strong class="command">make</strong></span>
	  </p><p>
		The last line of the output should be "<code class="code">PostGIS was built
		successfully. Ready to install.</code>"
	  </p><p>
		As of PostGIS v1.4.0, all the functions have comments generated from the
		documentation. If you wish to install these comments into your spatial
		databases later, run the command which requires docbook.  The postgis_comments.sql and other
		package comments files raster_comments.sql, topology_comments.sql are
			also packaged in the tar.gz distribution in the doc folder so no need to make comments
			if installing from the tar ball.
	  </p><p>
		<span><strong class="command">make comments</strong></span>
	  </p><p>
		Introduced in PostGIS 2.0. This generates html cheat sheets suitable for quick reference or for student handouts.
		This requires xsltproc to build and will generate 4 files in doc folder <code class="filename">topology_cheatsheet.html</code>, <code class="filename">tiger_geocoder_cheatsheet.html</code>, 
			<code class="filename">raster_cheatsheet.html</code>, <code class="filename">postgis_cheatsheet.html</code>
	  </p><p>You can download some pre-built ones available in html and pdf from <a href="http://www.postgis.us/study_guides" target="_top">PostGIS / PostgreSQL Study Guides</a></p><p>
		<span><strong class="command">make cheatsheets</strong></span>
	  </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="make_install_postgis_extensions"></a>2.4.3. Building PostGIS Extensions and Deploying them</h3></div></div></div><p>
		The PostGIS extensions are built and installed automatically if you are using PostgreSQL 9.1+. 
	  </p><p>If you are building from source repository, you need to build the function descriptions first. These get built if you have docbook installed. You can also manually build with the statement:</p><pre class="programlisting">make comments</pre><p>Building the comments is not necessary if you are building from a release tar ball since these are packaged pre-built with the tar ball already.</p><p>If you are building against PostgreSQL 9.1, the extensions should automatically build as part of the make install process.  You can if needed build from the extensions
	  folders or copy files if you need them on a different server. </p><pre class="programlisting">cd extensions
cd postgis
make clean
make 
make install
cd ..
cd postgis_topology
make clean
make 
make install
	  </pre><p>The extension files will always be the same for the same version of PostGIS regardless of OS, so it is fine to copy over the extension files from one OS to another as long as you
	  have the PostGIS binaries already installed on your servers. </p><p>If you want to install the extensions manually on a separate server different from your development,
		You need to copy the following files from the extensions folder into the <code class="filename">PostgreSQL / share / extension</code> folder
		of your PostgreSQL install as well as the needed binaries for regular PostGIS if you don't have them already on the server.
	  </p><div class="itemizedlist"><ul type="disc"><li><p>
			These are the control files that denote information such as the version of the extension to install if not specified.
			<code class="filename">postgis.control, postgis_topology.control</code>.
		  </p></li><li><p>
			All the files in the /sql folder of each extension.  Note that these need to be copied to the root of the PostgreSQL share/extension folder
			<code class="filename">extensions/postgis/sql/*.sql</code>, <code class="filename">extensions/postgis_topology/sql/*.sql</code>
		  </p></li></ul></div><p>Once you do that, you should see <code class="varname">postgis</code>, <code class="varname">postgis_topology</code> as available extensions in PgAdmin -&gt; extensions.</p><p>If you are using psql, you can verify that the extensions are installed by running this query:</p><pre class="programlisting">SELECT name, default_version,installed_version 
FROM pg_available_extensions WHERE name LIKE 'postgis%' ;
      name       | default_version | installed_version
-----------------+-----------------+-------------------
postgis          | 2.0.2SVN     | 2.0.2SVN
postgis_topology | 2.0.2SVN      | </pre><p>If you have the extension installed in the database you are querying, you'll see mention in the <code class="varname">installed_version</code> column.  
If you get no records back, it means you don't have postgis extensions installed on the server at all.  PgAdmin III 1.14+ will also provide this information
in the <code class="varname">extensions</code> section of the database browser tree and will even allow upgrade or uninstall by right-clicking.</p><p>If you have the extensions available, you can install postgis extension in your database of choice by either using pgAdmin extension interface or running these sql commands:</p><pre class="programlisting">CREATE EXTENSION postgis;
CREATE EXTENSION postgis_topology;</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Extension tables <code class="varname">spatial_ref_sys</code>, <code class="varname">layer</code>, <code class="varname">topology</code> can not be explicitly backed up.  They can only 
be backed up when the respective <code class="varname">postgis</code> or <code class="varname">postgis_topology</code> extension is backed up, which only seems to happen when you backup the whole database. 
As of PostGIS 2.0.1, only srid records not packaged with PostGIS are backed up when the database is backed up so don't go around changing srids we package and expect your changes to be there. Put in a ticket if you find an issue.  The structures of extension tables are never backed up since they are created with <code class="code">CREATE EXTENSION</code>
and assumed to be the same for a given version of an extension. These behaviors are built into the current PostgreSQL extension model, so nothing we can do about it.</p></td></tr></table></div><p>If you installed 2.0.2SVN, without using our wonderful extension system, you can change it to be extension based by first upgrading to the latest micro version running the upgrade scripts: <code class="filename">postgis_upgrade_20_minor.sql</code>,<code class="filename">raster_upgrade_20_minor.sql</code>,<code class="filename">topology_upgrade_20_minor.sql</code>.</p><p>If you installed postgis without raster support, you'll need to install raster support first (using the full <code class="filename">rtpostgis.sql</code></p><p>Then you can run teh below commands to package the functions in their respective extension.</p><pre class="programlisting">CREATE EXTENSION postgis FROM unpackaged;
CREATE EXTENSION postgis_topology FROM unpackaged;</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2843214"></a>2.4.4. Testing</h3></div></div></div><p>
		If you wish to test the PostGIS build, run
	  </p><p>
		<span><strong class="command">make check</strong></span>
	  </p><p>
		The above command will run through various checks and regression tests
		using the generated library against an actual PostgreSQL database.
	  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		  If you configured PostGIS using non-standard PostgreSQL, GEOS, or
		  Proj4 locations, you may need to add their library locations to the
		  LD_LIBRARY_PATH environment variable.
		</p></td></tr></table></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		  Currently, the <span><strong class="command">make check</strong></span> relies on the
		  <code class="code">PATH</code> and <code class="code">PGPORT</code> environment variables when
		  performing the checks - it does <span class="emphasis"><em>not</em></span> use the
		  PostgreSQL version that may have been specified using the
		  configuration parameter <span><strong class="command">--with-pgconfig</strong></span>. So make
		  sure to modify your PATH to match the detected PostgreSQL installation
		  during configuration or be prepared to deal with the impending
		  headaches.
		</p></td></tr></table></div><p>
		If successful, the output of the test should be similar to the
		following:
	  </p><pre class="programlisting">     CUnit - A Unit testing framework for C - Version 2.1-0
	 http://cunit.sourceforge.net/


Suite: print_suite
  Test: test_lwprint_default_format ... passed
  Test: test_lwprint_format_orders ... passed
  Test: test_lwprint_optional_format ... passed
  Test: test_lwprint_oddball_formats ... passed
  Test: test_lwprint_bad_formats ... passed
Suite: Misc Suite
  Test: test_misc_force_2d ... passed
  Test: test_misc_simplify ... passed
  Test: test_misc_count_vertices ... passed
  Test: test_misc_area ... passed
  Test: test_misc_wkb ... passed
Suite: PointArray Suite
  Test: test_ptarray_append_point ... passed
  Test: test_ptarray_append_ptarray ... passed
Suite: PostGIS Computational Geometry Suite
  Test: test_lw_segment_side ... passed
  Test: test_lw_segment_intersects ... passed
  Test: test_lwline_crossing_short_lines ... passed
  Test: test_lwline_crossing_long_lines ... passed
  Test: test_lwline_crossing_bugs ... passed
  Test: test_lwpoint_set_ordinate ... passed
  Test: test_lwpoint_get_ordinate ... passed
  Test: test_point_interpolate ... passed
  Test: test_lwline_clip ... passed
  Test: test_lwline_clip_big ... passed
  Test: test_lwmline_clip ... passed
  Test: test_geohash_point ... passed
  Test: test_geohash_precision ... passed
  Test: test_geohash ... passed
  Test: test_isclosed ... passed
Suite: PostGIS Measures Suite
  Test: test_mindistance2d_tolerance ... passed
  Test: test_rect_tree_contains_point ... passed
  Test: test_rect_tree_intersects_tree ... passed
  Test: test_lwgeom_segmentize2d ... passed
Suite: WKT Out Suite
  Test: test_wkt_out_point ... passed
  Test: test_wkt_out_linestring ... passed
  Test: test_wkt_out_polygon ... passed
  Test: test_wkt_out_multipoint ... passed
  Test: test_wkt_out_multilinestring ... passed
:
:
--Run Summary: Type      Total     Ran  Passed  Failed
               suites       17      17     n/a       0
               tests       143     143     143       0
               asserts    1228    1228    1228       0


Creating spatial db postgis_reg
 Postgis 2.0.0SVN - 2011-01-11 15:33:37
   GEOS: 3.3.0-CAPI-1.7.0
   PROJ: Rel. 4.6.1, 21 August 2008

Running tests

 loader/Point.............. ok
 loader/PointM.............. ok
 loader/PointZ.............. ok
 loader/MultiPoint.............. ok
 loader/MultiPointM.............. ok
 loader/MultiPointZ.............. ok
 loader/Arc.............. ok
 loader/ArcM.............. ok
 loader/ArcZ.......... ok
 loader/Polygon.............. ok
 loader/PolygonM.............. ok
 loader/PolygonZ.............. ok
 regress. ok
 regress_index. ok
 regress_index_nulls. ok
 lwgeom_regress. ok
 regress_lrs. ok
 removepoint. ok
 setpoint. ok
 simplify. ok
 snaptogrid. ok
 affine. ok
 measures. ok
 long_xact. ok
 ctors. ok
 sql-mm-serialize. ok
 sql-mm-circularstring. ok
 sql-mm-compoundcurve. ok
 sql-mm-curvepoly. ok
 sql-mm-general. ok
 sql-mm-multicurve. ok
 sql-mm-multisurface. ok
 polyhedralsurface. ok
 out_geometry. ok
 out_geography. ok
 in_gml. ok
 in_kml. ok
 iscollection. ok
 regress_ogc. ok
 regress_ogc_cover. ok
 regress_ogc_prep. ok
 regress_bdpoly. ok
 regress_proj. ok
 dump. ok
 dumppoints. ok
 wmsservers_new. ok
 tickets. ok
 remove_repeated_points. ok
 split. ok
 relatematch. ok
 regress_buffer_params. ok
 hausdorff. ok
 clean. ok
 sharedpaths. ok
 snap. ok

Run tests: 55
Failed: 0
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2843403"></a>2.4.5. Installation</h3></div></div></div><p>
		To install PostGIS, type
	  </p><p>
		<span><strong class="command">make install</strong></span>
	  </p><p>
		This will copy the PostGIS installation files into their appropriate
		subdirectory specified by the <span><strong class="command">--prefix</strong></span> configuration
		parameter. In particular:
	  </p><div class="itemizedlist"><ul type="disc"><li><p>
			The loader and dumper binaries are installed in
			<code class="filename">[prefix]/bin</code>.
		  </p></li><li><p>
			The SQL files, such as <code class="filename">postgis.sql</code>, are
			installed in <code class="filename">[prefix]/share/contrib</code>.
		  </p></li><li><p>
			The PostGIS libraries are installed in
			<code class="filename">[prefix]/lib</code>.
		  </p></li></ul></div><p>
		If you previously ran the <span><strong class="command">make comments</strong></span> command to
		generate the <code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code> file, install the
		sql file by running
	  </p><p>
		<span><strong class="command">make comments-install</strong></span>
	  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		  <code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code>, <code class="filename">topology_comments.sql</code> was separated from the
		  typical build and installation targets since with it comes the extra
		  dependency of <span><strong class="command">xsltproc</strong></span>.
		</p></td></tr></table></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create_new_db"></a>2.5. Create a spatially-enabled database on PostgreSQL lower than 9.1</h2></div></div></div><p>
	  The first step in creating a PostGIS database is to create a simple
	  PostgreSQL database.
	</p><p>
	  <span><strong class="command">createdb [yourdatabase]</strong></span>
	</p><p>
	  Many of the PostGIS functions are written in the PL/pgSQL procedural
	  language. As such, the next step to create a PostGIS database is to enable
	  the PL/pgSQL language in your new database. This is accomplish by the
	  command below command.  For PostgreSQL 8.4+, this is generally already installed
	</p><p>
	  <span><strong class="command">createlang plpgsql [yourdatabase]</strong></span>
	</p><p>
	  Now load the PostGIS object and function definitions into your database by
	  loading the <code class="filename">postgis.sql</code> definitions file (located in
	  <code class="filename">[prefix]/share/contrib</code> as specified during the
	  configuration step).
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -f postgis.sql</strong></span>
	</p><p>
	  For a complete set of EPSG coordinate system definition identifiers, you
	  can also load the <code class="filename">spatial_ref_sys.sql</code> definitions
	  file and populate the <code class="varname">spatial_ref_sys</code> table. This will
	  permit you to perform ST_Transform() operations on geometries.
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -f spatial_ref_sys.sql</strong></span>
	</p><p>
	  If you wish to add comments to the PostGIS functions, the final step is to
	  load the <code class="filename">postgis_comments.sql</code> into your spatial
	  database. The comments can be viewed by simply typing <span><strong class="command">\dd
	  [function_name]</strong></span> from a <span><strong class="command">psql</strong></span> terminal window.
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -f postgis_comments.sql</strong></span>
	</p><p>
	  Install raster support
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -f rtpostgis.sql</strong></span>
	</p><p>
	  Install raster support comments.  This will provide quick help info for each raster function
	  using psql or PgAdmin or any other PostgreSQL tool that can show function comments
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -f raster_comments.sql</strong></span>
	</p><p>
	  Install topology support
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -f topology/topology.sql</strong></span>
	</p><p>
	  Install topology support comments.  This will provide quick help info for each topology function / type
	  using psql or PgAdmin or any other PostgreSQL tool that can show function comments
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -f topology/topology_comments.sql</strong></span>
	</p><p>If you plan to restore an old backup from prior versions in this new db, run:</p><p><span><strong class="command">psql -d [yourdatabase] -f legacy.sql</strong></span></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>There is an alternative <code class="filename">legacy_minimal.sql</code> you can run instead which will install barebones needed to recover tables and work with apps like MapServer
	and GeoServer. If you have views that use things like distance / length etc, you'll need the full blown <code class="filename">legacy.sql</code></p></td></tr></table></div><p>You can later run <code class="filename">uninstall_legacy.sql</code> to get rid of the deprecated functions after you are done with restoring and cleanup.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create_new_db_extensions"></a>2.6. Creating a spatial database using EXTENSIONS</h2></div></div></div><p>
	 If you are using PostgreSQL 9.1+ and have compiled and installed the extensions/ postgis modules, you 
	 can create a spatial database the new way.
	</p><p>
	  <span><strong class="command">createdb [yourdatabase]</strong></span>
	</p><p>
	  The core postgis extension installs PostGIS geometry, geography, raster, spatial_ref_sys and all the functions and comments with a simple:
	  </p><pre class="programlisting">CREATE EXTENSION postgis;</pre><p> command.
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -c "CREATE EXTENSION postgis;"</strong></span>
	</p><p>
	  Topology is packaged as a separate extension and installable with command:
	</p><p>
	  <span><strong class="command">psql -d [yourdatabase] -c "CREATE EXTENSION postgis_topology;"</strong></span>
	</p><p>If you plan to restore an old backup from prior versions in this new db, run:</p><p><span><strong class="command">psql -d [yourdatabase] -f legacy.sql</strong></span></p><p>You can later run <code class="filename">uninstall_legacy.sql</code> to get rid of the deprecated functions after you are done with restoring and cleanup.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="loading_extras_tiger_geocoder"></a>2.7. Installing, Upgrading Tiger Geocoder and loading data</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="postgis_installation.html#install_tiger_geocoder">2.7.1. Tiger Geocoder Enabling your PostGIS database</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#upgrade_tiger_geocoder">2.7.2. Upgrading your Tiger Geocoder Install</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#tiger_geocoder_loading_data">2.7.3. Loading Tiger Data</a></span></dt></dl></div><p>The Tiger geocoder does not get installed / upgraded with the core PostGIS scripts because it is only of regional use.  In fact nothing located
	in the extras folder is installed by default with the regular PostGIS install / upgrade.  Extras like Tiger geocoder may also not be packaged in your PostGIS distribution, but will always be available in the postgis-2.0.2SVN.tar.gz file. The instructions provided here are also available in the <code class="filename">extras/tiger_geocoder/tiger_2010/README</code> </p><p>If you are on Windows and you don't have tar installed, you can use <a href="http://www.7-zip.org/" target="_top">http://www.7-zip.org/</a> to unzip the PostGIS tarball.</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="install_tiger_geocoder"></a>2.7.1. Tiger Geocoder Enabling your PostGIS database</h3></div></div></div><p>
		  First install PostGIS using the prior instructions.
		</p><p>
		  If you don't have an extras folder, download <a href="http://www.postgis.org/download/postgis-2.0.2SVN.tar.gz" target="_top">http://www.postgis.org/download/postgis-2.0.2SVN.tar.gz</a>
		</p><p>
		  <span><strong class="command">tar xvfz postgis-2.0.2SVN.tar.gz</strong></span>
		</p><p>
		  <span><strong class="command">cd postgis-2.0.2SVN/extras/tiger_geocoder/tiger_2010</strong></span>
		</p><p>Edit the <code class="filename">tiger_loader.sql</code> to the paths of your executables server etc.</p><p>If you are installing Tiger geocoder for the first time edit either the <code class="filename">create_geocode.bat</code> script If you are on windows
			or the <code class="filename">create_geocode.sh</code> if you are on Linux/Unix/Mac OSX with your PostgreSQL specific settings and run the corresponding script from the commandline. If you don't edit this file, it will just contain common case locations of items.  You can edit the generated script after the fact when you run the  <a href="Loader_Generate_Script.html" title="Loader_Generate_Script">Loader_Generate_Script</a>  command.
		</p><p>Verify that you now have a <code class="varname">tiger</code> schema in your database and that it is part of your database search_path.  If it is not, add it with a command something along the line of: </p><pre class="programlisting">ALTER DATABASE geocoder SET search_path=public, tiger;</pre><p>The normalizing address functionality works more or less without any data except for tricky addresses.  Run this test and verify things look like this: 
			</p><pre class="programlisting">SELECT pprint_addy(normalize_address('202 East Fremont Street, Las Vegas, Nevada 89101')) As pretty_address;
pretty_address
---------------------------------------
202 E Fremont St, Las Vegas, NV 89101
			</pre><p>
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade_tiger_geocoder"></a>2.7.2. Upgrading your Tiger Geocoder Install</h3></div></div></div><p>
		  If you have Tiger Geocoder packaged with 2.0 already installed, you can upgrade the functions at any time even from an interim tar ball if there are fixes you badly need.
		</p><p>
		  If you don't have an extras folder, download <a href="http://www.postgis.org/download/postgis-2.0.2SVN.tar.gz" target="_top">http://www.postgis.org/download/postgis-2.0.2SVN.tar.gz</a>
		</p><p>
		  <span><strong class="command">tar xvfz postgis-2.0.2SVN.tar.gz</strong></span>
		</p><p>
		  <span><strong class="command">cd postgis-2.0.2SVN/extras/tiger_geocoder/tiger_2010</strong></span>
		</p><p>Locate the  <code class="filename">upgrade_geocoder.bat</code> script If you are on windows
			or the <code class="filename">upgrade_geocoder.sh</code> if you are on Linux/Unix/Mac OSX.  Edit the file to have your postgis database credientials and run then corresponding script from the commandline.
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tiger_geocoder_loading_data"></a>2.7.3. Loading Tiger Data</h3></div></div></div><p>The instructions for loading data are available in a more detailed form  in the <code class="filename">extras/tiger_geocoder/tiger_2010/README</code>.  This just includes the general steps.</p><p>The load process downloads data from the census website for the respective states requested, extracts the files, and then loads each state into its own separate
		set of state tables.  Each state table inherits from the tables defined in <code class="varname">tiger</code> schema so that its sufficient to just query those tables to access all the data and drop a set of state tables at any time using the <a href="Drop_State_Tables_Generate_Script.html" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a> if you need to reload a state or just don't need a state anymore.</p><p>In order to be able to load data you'll need the following tools:</p><div class="itemizedlist"><ul type="disc"><li><p>A tool to unzip the zip files from census website.</p><p>For Unix like systems: <code class="varname">unzip</code> executable which is usually already installed on most Unix like platforms.</p><p>For Windows, 7-zip which is a free compress/uncompress tool you can download from <a href="http://www.7-zip.org/" target="_top">http://www.7-zip.org/</a> </p></li><li><p><code class="filename">shp2pgsql</code> commandline which is installed by default when you install PostGIS.</p></li><li><p><code class="filename">wget</code> which is a web grabber tool usually installed on most Unix/Linux systems.</p><p>If you are on windows, you can get pre-compiled binaries from <a href="http://gnuwin32.sourceforge.net/packages/wget.htm" target="_top">http://gnuwin32.sourceforge.net/packages/wget.htm</a> </p></li></ul></div><p>To load data refer to <a href="Loader_Generate_Script.html" title="Loader_Generate_Script">Loader_Generate_Script</a> to generate a data load script for your platform for the states you desire.  
			Note that you can install these piecemeal. You don't have to load all the states you want all at once.  You can load them as you need them.</p><p>After the states you desire have been loaded, make sure to run the:
		</p><pre class="programlisting">SELECT install_missing_indexes();</pre><p> as described in  <a href="Install_Missing_Indexes.html" title="Install_Missing_Indexes">Install_Missing_Indexes</a>.</p><p>To test that things are working as they should, try to run a geocode on an address in your state using <a href="Geocode.html" title="Geocode">Geocode</a> </p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="templatepostgis"></a>2.8. Create a spatially-enabled database from a template</h2></div></div></div><p>
	  Some packaged distributions of PostGIS (in particular the Win32 installers
	  for PostGIS &gt;= 1.1.5) load the PostGIS functions into a template
	  database called <code class="varname">template_postgis</code>. If the
	  <code class="varname">template_postgis</code> database exists in your PostgreSQL
	  installation then it is possible for users and/or applications to create
	  spatially-enabled databases using a single command. Note that in both
	  cases, the database user must have been granted the privilege to create
	  new databases.
	</p><p>
	  From the shell:
	</p><pre class="programlisting"># createdb -T template_postgis my_spatial_db</pre><p>
	  From SQL:
	</p><pre class="programlisting">postgres=# CREATE DATABASE my_spatial_db TEMPLATE=template_postgis</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrading"></a>2.9. Upgrading</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="postgis_installation.html#soft_upgrade">2.9.1. Soft upgrade</a></span></dt><dt><span class="sect2"><a href="postgis_installation.html#hard_upgrade">2.9.2. Hard upgrade</a></span></dt></dl></div><p>
	  Upgrading existing spatial databases can be tricky as it requires
	  replacement or introduction of new PostGIS object definitions.
	</p><p>
	  Unfortunately not all definitions can be easily replaced in a live
	  database, so sometimes your best bet is a dump/reload process.
	</p><p>
	  PostGIS provides a SOFT UPGRADE procedure for minor or bugfix releases,
	  and a HARD UPGRADE procedure for major releases.
	</p><p>
	  Before attempting to upgrade PostGIS, it is always worth to backup your
	  data. If you use the -Fc flag to pg_dump you will always be able to
	  restore the dump with a HARD UPGRADE.
	</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soft_upgrade"></a>2.9.1. Soft upgrade</h3></div></div></div><p>If you installed your database using extensions, you'll need to upgrade using the extension model as well.  If you installed using the old sql script way,
	  then you should upgrade using the sql script way. Please refer to the appropriate.</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_sql_script"></a>2.9.1.1. Soft Upgrade Pre 9.1+ or without extensions</h4></div></div></div><p>This section applies only to those who installed PostGIS not using extensions.  If you have extensions and try to upgrade with this approach you'll get messages like:</p><pre class="programlisting">can't drop ... because postgis extension depends on it</pre><p>
		After compiling you should find several <code class="filename">postgis_upgrade*.sql</code> files.  Install the one
		for your version of PostGIS.  For example <code class="filename">postgis_upgrade_13_to_15.sql</code> should be used if you are upgrading 
		from PostGIS 1.3 to 1.5.  If you are moving from PostGIS 1.* to PostGIS 2.* or from PostGIS 2.* prior to r7409, you need to do a HARD UPGRADE.
	  </p><pre class="programlisting">psql -f postgis_upgrade_20_minor.sql -d your_spatial_database</pre><p>
		The same procedure applies to raster and
		topology extensions, with upgrade files named
		<code class="filename">rtpostgis_upgrade*.sql</code> and
		<code class="filename">topology_upgrade*.sql</code> respectively.
		If you need them:
	  </p><pre class="programlisting">psql -f rtpostgis_upgrade_20_minor.sql -d your_spatial_database</pre><pre class="programlisting">psql -f topology_upgrade_20_minor.sql -d your_spatial_database</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		  If you can't find the <code class="filename">postgis_upgrade*.sql</code> specific for upgrading your version you are using a version too early for
		  a soft upgrade and need to do a HARD UPGRADE.
		</p></td></tr></table></div><p>
		The <a href="PostGIS_Full_Version.html" title="PostGIS_Full_Version">PostGIS_Full_Version</a> function
		should inform you about the need to run this kind of
		upgrade using a "procs need upgrade" message.
	  </p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_extensions"></a>2.9.1.2. Soft Upgrade 9.1+ using extensions</h4></div></div></div><p>If you originally installed PostGIS with extensions, then you need to upgrade using extensions as well.  Doing a minor upgrade with extensions, is fairly painless.</p><pre class="programlisting">ALTER EXTENSION postgis UPDATE TO "2.0.2SVN";
ALTER EXTENSION postgis_topology UPDATE TO "2.0.2SVN";</pre><p>If you get an error notice something like:</p><pre class="programlisting">No migration path defined for ... to 2.0.2SVN</pre><p>Then you'll need to backup your database, create a fresh one as described in <a href="postgis_installation.html#create_new_db_extensions" title="2.6. Creating a spatial database using EXTENSIONS">Section 2.6, &#8220;Creating a spatial database using EXTENSIONS&#8221;</a> and then restore your backup on top of this new database.
		You might get a message that <code class="code">postgis extension</code> already installed which you can safely ignore.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If you installed PostGIS originally without a version specified, you can often skip the reinstallation of postgis extension before restoring since the backup just has <code class="code">CREATE EXTENSION postgis</code> and thus
		picks up the newest latest version during restore. .</p></td></tr></table></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="hard_upgrade"></a>2.9.2. Hard upgrade</h3></div></div></div><p>
		By HARD UPGRADE we mean full dump/reload of postgis-enabled databases.
		You need a HARD UPGRADE when PostGIS objects' internal storage changes
		or when SOFT UPGRADE is not possible. The
		<a href="release_notes.html" title="Appendix A. Appendix">Release Notes</a>
		appendix reports for each version whether you need a dump/reload (HARD
		UPGRADE) to upgrade.
	  </p><p>
		The dump/reload process is assisted by the postgis_restore.pl
		script which takes care of skipping from the dump all
		definitions which belong to PostGIS (including old ones),
		allowing you to restore your schemas and data into a
		database with PostGIS installed without getting duplicate
		symbol errors or bringing forward deprecated objects.
	  </p><p>Supplementary instructions for windows users are available at  <a href="http://trac.osgeo.org/postgis/wiki/UsersWikiWinUpgrade" target="_top">Windows Hard upgrade</a>.</p><p>
		The Procedure is as follows:
	  </p><div class="orderedlist"><ol type="1"><li><p>
		Create a "custom-format" dump of the database you want
		to upgrade (let's call it <code class="varname">olddb</code>)
		include binary blobs (-b) and verbose (-v) output.
		The user can be the owner of the db, need not be postgres
		super account.
	  </p><pre class="programlisting">pg_dump -h localhost -p 5432 -U postgres -Fc -b -v -f "/somepath/olddb.backup" olddb</pre></li><li><p>
		Do a fresh install of PostGIS in a new database -- we'll
		refer to this database as <code class="varname">newdb</code>.
		Please refer to <a href="postgis_installation.html#create_new_db" title="2.5. Create a spatially-enabled database on PostgreSQL lower than 9.1">Section 2.5, &#8220;Create a spatially-enabled database on PostgreSQL lower than 9.1&#8221;</a> and <a href="postgis_installation.html#create_new_db_extensions" title="2.6. Creating a spatial database using EXTENSIONS">Section 2.6, &#8220;Creating a spatial database using EXTENSIONS&#8221;</a> for
		instructions on how to do this.
	  </p><p>
		The spatial_ref_sys entries found in your dump will be
		restored, but they will not override existing ones in
		spatial_ref_sys.  This is to ensure that fixes in the
		official set will be properly propagated to restored
		databases. If for any reason you really want your own
		overrides of standard entries just don't load the
		spatial_ref_sys.sql file when creating the new db.
	  </p><p>
		If your database is really old or you know you've
		been using long deprecated functions in your
		views and functions, you might need to load
		<code class="filename">legacy.sql</code> for all your functions
		and views etc. to properly come back.
		Only do this if _really_ needed. Consider upgrading your
		views and functions before dumping instead, if possible.
		The deprecated functions can be later removed by loading
		<code class="filename">uninstall_legacy.sql</code>.
	  </p></li><li><p>
		Restore your backup into your fresh
		<code class="varname">newdb</code> database using
		postgis_restore.pl.
		Unexpected errors, if any, will be printed to the standard
		error stream by psql. Keep a log of those.
	  </p><pre class="programlisting">perl utils/postgis_restore.pl "/somepath/olddb.backup" | psql -h localhost -p 5432 -U postgres newdb 2&gt; errors.txt</pre></li></ol></div><p>
		Errors may arise in the following cases:
	</p><div class="orderedlist"><ol type="1"><li><p>
		Some of your views or functions make use of deprecated PostGIS objects.
		In order to fix this you may try loading <code class="filename">legacy.sql</code>
		script prior to restore or you'll have to restore to a
		version of PostGIS which still contains those objects
		and try a migration again after porting your code.
		If the <code class="filename">legacy.sql</code> way works for you, don't forget
		to fix your code to stop using deprecated functions and drop them
		loading <code class="filename">uninstall_legacy.sql</code>.
	</p></li><li><p>
		Some custom records of spatial_ref_sys in dump file have
		an invalid SRID value. Valid SRID values are bigger than 0
		and smaller than 999000. Values in the 999000.999999 range
    are reserved for internal use while values &gt; 999999 can't
    be used at all.
    All your custom records with invalid SRIDs will be retained,
    with those &gt; 999999 moved into the reserved range, but the
    spatial_ref_sys table would loose a check constraint guarding
    for that invariant to hold and possibly also its primary key
    ( when multiple invalid SRIDS get converted to the same reserved
    SRID value ).
  </p><p>
		In order to fix this you should copy your custom SRS to
		a SRID with a valid value (maybe in the 910000..910999
		range), convert all your tables to the new srid (see
		<a href="UpdateGeometrySRID.html" title="UpdateGeometrySRID">UpdateGeometrySRID</a>), delete the invalid
		entry from spatial_ref_sys and re-construct the check(s) with:

		</p><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD CONSTRAINT spatial_ref_sys_srid_check check (srid &gt; 0 AND srid &lt; 999000 );</pre><p>

		</p><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD PRIMARY KEY(srid));</pre><p>
	
	</p></li></ol></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2844803"></a>2.10. Common Problems</h2></div></div></div><p>
	  There are several things to check when your installation or upgrade
	  doesn't go as you expected.
	</p><div class="orderedlist"><ol type="1"><li><p>
		  Check that you have installed PostgreSQL 8.4
		  or newer, and that you are compiling against the same version of the
		  PostgreSQL source as the version of PostgreSQL that is running.
		  Mix-ups can occur when your (Linux) distribution has already
		  installed PostgreSQL, or you have otherwise installed PostgreSQL
		  before and forgotten about it. PostGIS will only work with PostgreSQL
		  8.4 or newer, and strange, unexpected
		  error messages will result if you use an older version. To check the
		  version of PostgreSQL which is running, connect to the database using
		  psql and run this query:
		</p><pre class="programlisting">SELECT version();</pre><p>
		  If you are running an RPM based distribution, you can check for the
		  existence of pre-installed packages using the <span><strong class="command">rpm</strong></span>
		  command as follows: <span><strong class="command">rpm -qa | grep postgresql</strong></span>
		</p></li><li><p>If your upgrade fails, make sure you are restoring into a database that already has PostGIS installed.</p><pre class="programlisting">SELECT postgis_full_version();</pre></li></ol></div><p>
	  Also check that configure has correctly detected the location and version
	  of PostgreSQL, the Proj4 library and the GEOS library.
	</p><div class="orderedlist"><ol type="1"><li><p>
		  The output from configure is used to generate the
		  <code class="filename">postgis_config.h</code> file. Check that the
		  <code class="varname">POSTGIS_PGSQL_VERSION</code>,
		  <code class="varname">POSTGIS_PROJ_VERSION</code> and
		  <code class="varname">POSTGIS_GEOS_VERSION</code> variables have been set
		  correctly.
		</p></li></ol></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2844910"></a>2.11. JDBC</h2></div></div></div><p>
	  The JDBC extensions provide Java objects corresponding to the internal
	  PostGIS types. These objects can be used to write Java clients which query
	  the PostGIS database and draw or do calculations on the GIS data in
	  PostGIS.
	</p><div class="orderedlist"><ol type="1"><li><p>
		  Enter the <code class="filename">java/jdbc</code> sub-directory of the PostGIS
		  distribution.
		</p></li><li><p>
		  Run the <code class="filename">ant</code> command. Copy the
		  <code class="filename">postgis.jar</code> file to wherever you keep your java
		  libraries.
		</p></li></ol></div><p>
	  The JDBC extensions require a PostgreSQL JDBC driver to be present in the
	  current CLASSPATH during the build process. If the PostgreSQL JDBC driver
	  is located elsewhere, you may pass the location of the JDBC driver JAR
	  separately using the -D parameter like this:
	</p><pre class="programlisting"># ant -Dclasspath=/path/to/postgresql-jdbc.jar</pre><p>
	  PostgreSQL JDBC drivers can be downloaded from
	  <a href="http://jdbc.postgresql.org" target="_top">
		http://jdbc.postgresql.org
	  </a>
	  .
	</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2844985"></a>2.12. Loader/Dumper</h2></div></div></div><p>
	  The data loader and dumper are built and installed automatically as part
	  of the PostGIS build. To build and install them manually:
	</p><pre class="programlisting"># cd postgis-2.0.2SVN/loader
# make
# make install</pre><p>
	  The loader is called <code class="filename">shp2pgsql</code> and converts ESRI
	  Shape files into SQL suitable for loading in PostGIS/PostgreSQL. The
	  dumper is called <code class="filename">pgsql2shp</code> and converts PostGIS
	  tables (or queries) into ESRI Shape files. For more verbose documentation,
	  see the online help, and the manual pages.
	</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="postgis_introduction.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="PostGIS_FAQ.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 1. Introduction </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 3. PostGIS Frequently Asked Questions</td></tr></table></div></body></html>
