<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>ST_Union</title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="PostGIS 2.0.2SVN Manual"><link rel="up" href="RT_reference.html#Raster_Processing" title="9.11. Raster Processing"><link rel="prev" href="RT_ST_Reclass.html" title="ST_Reclass"><link rel="next" href="RT_ST_Min4ma.html" title="ST_Min4ma"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ST_Union</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="RT_ST_Reclass.html">Prev</a> </td><th width="60%" align="center">9.11. Raster Processing</th><td width="20%" align="right"> <a accesskey="n" href="RT_ST_Min4ma.html">Next</a></td></tr></table><hr></div><div class="refentry" lang="en"><a name="RT_ST_Union"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>ST_Union &#8212; Returns the union of a set of raster tiles into a single raster composed of 1 band.  If no band is specified for unioning, band num 1 is assumed.  The resulting raster's extent is the extent of the whole set.  In the case of intersection, the resulting value is defined by p_expression which is one of the following: LAST - the default when none is specified, MEAN, SUM, FIRST, MAX, MIN.</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster  <var class="pdparam">rast</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>raster set <var class="pdparam">rast</var>, integer <var class="pdparam">band_num</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>raster set <var class="pdparam">rast</var>, text <var class="pdparam">p_expression</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>raster set <var class="pdparam">rast</var>, integer <var class="pdparam">band_num</var>, text <var class="pdparam">p_expression</var><code>)</code>;</p></div></div><div class="refsection" lang="en"><a name="id3042438"></a><h2>Description</h2><p>Returns the union of a set of raster tiles into a single raster composed of 1 band.  If no band is specified for unioning, band num 1 is assumed.  The resulting raster's extent is the extent of the whole set.  In the case of intersection, the resulting value is defined by p_expression which is one of the following: LAST - the default when none is specified, MEAN, SUM, FIRST, MAX, MIN </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>There are several other variants of this function not installed by default in PostGIS 2.0.0 -- these can be found in the raster/scripts/plpgsql/st_union.sql file of postgis source code.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The ST_Union function in 2.0.0 is currently implemented predominantly in plpgsql.  Because of the memory copying needed to copy between the C and plpgsql layer, this function is much much slower than it needs to be.
				Future 2.0 releases will have this function implemented in C, so you should witness significant improvements in speed when that happens.  As a general rule of thumb you want to minimize the size of the rasters, that ST_Union works with.
				One approach is to clip first and then union the clipped versions.  Refer to select parcels example in  <a href="RT_ST_MapAlgebraExpr2.html" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>.  That example if unioning is done before clipping takes about 4 times longer. With the higher res imagery the timing the ratio between is even higher.</p></td></tr></table></div><p>Availability: 2.0.0 </p></div><div class="refsection" lang="en"><a name="id3042489"></a><h2>Examples: Reconstitute a single band chunked raster tile</h2><pre class="programlisting">-- this creates a single band from first band of raster tiles
-- that form the original file system tile
SELECT filename, ST_Union(rast) As file_rast
FROM sometable WHERE filename IN('dem01', 'dem02') GROUP BY filename;</pre></div><div class="refsection" lang="en"><a name="id3042506"></a><h2>Examples: Return a multi-band raster that is the union of tiles intersecting geometry</h2><pre class="programlisting">-- this creates a multi band raster collecting all the tiles that intersect a line
SELECT ST_AddBand(NULL,ARRAY[ST_Union(rast,1), ST_Union(rast,2), ST_Union(rast,3) ])
FROM aerials.boston
WHERE ST_Intersects(rast,  ST_GeomFromText('LINESTRING(230486 887771, 230500 88772)',26986) );</pre></div><div class="refsection" lang="en"><a name="id3042528"></a><h2>See Also</h2><p><a href="RT_ST_Envelope.html" title="ST_Envelope">ST_Envelope</a>, <a href="RT_ST_ConvexHull.html" title="ST_ConvexHull">ST_ConvexHull</a>, , <a href="RT_ST_MapAlgebraExpr2.html" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a></p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="RT_ST_Reclass.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="RT_reference.html#Raster_Processing">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="RT_ST_Min4ma.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">ST_Reclass </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> ST_Min4ma</td></tr></table></div></body></html>
